webpackJsonp([0],{"+m9+":function(t,s){},NcgL:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e("TToO"),r=e("7+uW"),o=e("c+8m"),a=e.n(o),n=e("0Zxd"),c=e("NYxO"),l=(h("computed",c.e),h("computed",c.c),h("methods",c.b));h("methods",c.d);function h(t,s){function e(e,i){return Object(o.createDecorator)(function(r,o){r[t]||(r[t]={});var a,n=((a={})[o]=e,a);r[t][o]=void 0!==i?s(i,n)[o]:s(n)[o]})}return function(t,s){if("string"==typeof s){var i=s,r=t;return e(i,void 0)(r,i)}return e(t,function(t){var s=t&&t.namespace;if("string"==typeof s)return"/"!==s[s.length-1]?s+"/":s}(s))}}var d=e("qxKj"),u=e("EOM2"),p=e("DZ+H"),y=function(t){function s(){var s=null!==t&&t.apply(this,arguments)||this;return s.fetching=!1,s.isplay=!1,s.duration=s.song.interval,s.progress=0,s.elapsed=0,s.progressIntervalId=0,s.lyrics=[],s.index=0,s.LINE_HEIGHT=42,s.lyricIntervalId=0,s}return i.d(s,t),Object.defineProperty(s.prototype,"isShowPlayer",{get:function(){return this.$store.state.isShowPlayer},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isPlay",{get:function(){return this.$store.state.isPlay},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"$audio",{get:function(){return this.$refs.audio},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"$progress",{get:function(){return this.$refs.$progress},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"$lyricsLines",{get:function(){return this.$refs.lyricsLines},enumerable:!0,configurable:!0}),s.prototype.created=function(){this.init()},s.prototype.mounted=function(){document.body.classList.add("noscroll")},s.prototype.init=function(){var t=this;this.fetching=!0,Object(n.a)(this.song.songid).then(function(t){return t.lyric}).then(function(s){t.index=0,t.lyrics=t.formatText(s).match(/^\[\d{2}:\d{2}.\d{2}\](.+)$/gm)}).catch(function(t){return console.error(t)}).then(function(){return t.fetching=!1})},s.prototype.onPlay=function(){if(this.isplay=!this.isplay,this.isplay){if(this.fetching)return;this.$audio.play(),this.setPlayState(!0),this.startLyrics(),this.startProgress()}else this.$audio.pause(),this.setPlayState(!1),this.pauseLyrics(),this.pauseProgress()},s.prototype.onEnd=function(){this.$audio.play(),this.restartProgress(),this.restartLyrics()},s.prototype.startLyrics=function(){this.pauseLyrics(),this.lyricIntervalId=setInterval(this.updateLyrics.bind(this),1e3)},s.prototype.pauseLyrics=function(){clearInterval(this.lyricIntervalId)},s.prototype.updateLyrics=function(){var t=this;if(this.$audio.ontimeupdate=function(s){for(var e=0,i=t.lyrics.length;e<i;e++)t.$audio.currentTime>t.getSeconds(t.lyrics[e])-.5&&(t.$lyricsLines.children[t.index].classList.remove("active"),t.$lyricsLines.children[e].classList.add("active"),t.index=e)},this.index>2){var s=-(this.index-2)*this.LINE_HEIGHT;this.$lyricsLines.style.transform="translateY("+s+"px)"}},s.prototype.resetLyrics=function(){this.pauseLyrics(),this.$lyricsLines.children[this.index].classList.remove("active"),this.index=0,this.$lyricsLines.style.transform="translateY(0)",this.lyrics.length&&this.$lyricsLines.children[this.index].classList.add("active")},s.prototype.restartLyrics=function(){this.resetLyrics(),this.startLyrics()},s.prototype.startProgress=function(){this.pauseProgress(),this.progressIntervalId=setInterval(this.updateProgress.bind(this),50)},s.prototype.pauseProgress=function(){clearInterval(this.progressIntervalId)},s.prototype.updateProgress=function(){this.elapsed+=.05,this.progress=this.elapsed/this.duration,this.$progress.style.transform="translateX("+(100*this.progress-100)+"%)"},s.prototype.resetProgress=function(t){this.pauseProgress();this.elapsed=0,this.progress=0,this.$progress.style.transform="translate(-100%)",t&&(this.duration=+t)},s.prototype.restartProgress=function(){this.resetProgress(),this.startProgress()},s.prototype.getAlbumCover=function(t){return Object(d.a)(t)},s.prototype.getSongUrl=function(t){return Object(d.d)(t)},s.prototype.exit=function(){this.cancelPlayer(),this.setPlayState(!1),document.body.classList.remove("noscroll")},s.prototype.getSeconds=function(t){return+t.replace(/^\[(\d{2}):(\d{2}\.\d{2}).*/,function(t,s,e){return 60*+s+parseFloat(+e)})},s.prototype.formatText=function(t){var s=document.createElement("div");return s.innerHTML=t,s.innerText},i.c([Object(u.Prop)(Object)],s.prototype,"song",void 0),i.c([Object(u.Prop)(String)],s.prototype,"artist",void 0),i.c([l("cancelPlayer")],s.prototype,"cancelPlayer",void 0),i.c([l("setPlayState")],s.prototype,"setPlayState",void 0),s=i.c([a()({mixins:[p.a]})],s)}(r.default),g={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("transition",{attrs:{name:"show-transition"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowPlayer,expression:"isShowPlayer"}],class:{show:t.isShowPlayer},attrs:{id:"player"}},[e("div",{staticClass:"player-container"},[e("div",{staticClass:"player-header"},[e("img",{staticClass:"album-cover",attrs:{src:t.getAlbumCover(t.song.albummid),alt:"图片"}}),t._v(" "),e("div",{staticClass:"song-info"},[e("div",{staticClass:"song-name",domProps:{innerHTML:t._s(t.song.songname)}}),t._v(" "),e("div",{staticClass:"song-artist",domProps:{innerHTML:t._s(t.artist)}})]),t._v(" "),e("span",{staticClass:"icon-action icon-play",class:[t.isPlay?"icon-pause":"icon-play"],on:{click:t.onPlay}})]),t._v(" "),e("div",{staticClass:"player-lyrics"},[e("div",{ref:"lyricsLines",staticClass:"player-lyrics-lines"},[t._l(t.lyrics,function(s){return e("div",{directives:[{name:"show",rawName:"v-show",value:0!==t.lyrics.length,expression:"lyrics.length !== 0"}],staticClass:"player-lyrics-line"},[t._v(t._s(s.slice(10)))])}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.fetching,expression:"fetching"}],staticClass:"player-lyrics-line"},[t._v("正在加载歌词,请等待...")])],2)]),t._v(" "),e("div",{staticClass:"player-footer"},[e("div",{staticClass:"icon-list",on:{click:t.exit}}),t._v(" "),e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-time progress-elapsed"},[t._v(t._s(t._f("formatTime")(t.elapsed)))]),t._v(" "),e("div",{staticClass:"progress-bar"},[e("div",{ref:"$progress",staticClass:"progress-bar-progress"})]),t._v(" "),e("div",{staticClass:"progress-time progress-duration"},[t._v(t._s(t._f("formatTime")(t.song.interval)))])]),t._v(" "),e("div",{staticClass:"action"},[e("a",{staticClass:"btn-download",attrs:{href:"#"}},[t._v("下载这首歌")])])])]),t._v(" "),e("div",{staticClass:"player-background",style:{backgroundImage:"url("+t.getAlbumCover(t.song.albummid)+")"}}),t._v(" "),e("audio",{ref:"audio",attrs:{src:t.getSongUrl(t.song.songmid)},on:{ended:function(s){t.onEnd()}}})])])},staticRenderFns:[]};var v=e("VU/8")(y,g,!1,function(t){e("+m9+")},"data-v-0caea540",null).exports,f=function(t){function s(){var s=null!==t&&t.apply(this,arguments)||this;return s.hotkeys=null,s.data="",s.keyword="",s.fetching=!1,s.isLoad=!0,s.page=1,s.isShowCancel=!1,s.isShowDelete=!1,s.isShowHistory=!1,s.isShowSearchResults=!1,s.songsObject={},s.searchResult=null,s.history=[],s}return i.d(s,t),Object.defineProperty(s.prototype,"song",{get:function(){return this.$store.state.song},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"artist",{get:function(){return this.$store.state.artist},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isShowPlayer",{get:function(){return this.$store.state.isShowPlayer},enumerable:!0,configurable:!0}),s.prototype.created=function(){var t=this;Object(n.b)().then(function(s){var e=s.data.hotkey;t.data=s.data,t.hotkeys=t.shuffle(e,6)})},s.prototype.mounted=function(){window.addEventListener("scroll",this.onScroll.bind(this)),this.history=localStorage.getItem("SET_HISTORY_KEY")?localStorage.getItem("SET_HISTORY_KEY").split(","):[]},s.prototype.enter=function(t){this.keyword?this.isShowDelete=!0:(this.isShowDelete=!1,this.reset()),13===t.keyCode&&(this.isShowHistory=!1,this.isShowSearchResults=!0,this.addHistory(this.keyword),this.search(this.keyword))},s.prototype.onClick=function(t){if(t.target.matches("#search")&&(this.isShowCancel=!0,this.isShowHistory=!0),t.target.matches(".search-cancel")&&(this.isShowCancel=!1,this.isShowDelete=!1,this.isShowHistory=!1,this.reset()),t.target.matches(".icon-delete")&&(this.isShowDelete=!1,this.reset()),t.target.matches(".record-delete")&&(this.history=[],this.setLocalStorageData(this.history)),t.target.matches(".icon-close")){var s=this.history.indexOf(t.target.previousElementSibling.innerHTML);this.history.splice(s,1),this.setLocalStorageData(this.history)}(t.target.matches(".tag-keyword")||t.target.matches(".record-con"))&&(this.keyword=t.target.innerHTML,this.isShowDelete=!0,this.isShowCancel=!0,this.isShowHistory=!1,this.isShowSearchResults=!0,this.addHistory(this.keyword),this.search(this.keyword))},s.prototype.search=function(t,s){var e=this;void 0===t&&(t=""),""!==t&&(this.keyword===t&&this.songsObject[s||this.page]||(this.keyword!==t&&this.reset(),!this.fetching&&this.isLoad&&(this.keyword=t,this.loading(),Object(n.e)(t,s||this.page).then(function(t){e.page=t.data.song.curpage,e.songsObject[e.page]=t.data.song.list,e.searchResult?e.searchResult=e.searchResult.concat(t.data.song.list):e.searchResult=t.data.song.list,e.isLoad="no results"!==t.message,console.log(t)}).then(function(){return e.accomplish()}).catch(function(t){console.log(t)}))))},s.prototype.onScroll=function(t){if(!this.isLoad)return window.removeEventListener("scroll",this.onScroll.bind(this));document.documentElement.clientHeight+pageYOffset>document.body.scrollHeight-100&&this.search(this.keyword,this.page+1)},s.prototype.accomplish=function(){this.fetching=!1},s.prototype.loading=function(){this.fetching=!0},s.prototype.reset=function(){this.page=1,this.keyword="",this.isLoad=!0,this.songsObject={},this.searchResult=null},s.prototype.addHistory=function(t){-1===this.history.indexOf(t)&&(this.history.unshift(t),this.setLocalStorageData(this.history))},s.prototype.shuffle=function(t,s){for(var e=[],i=Math.min(s,t.length),r=0;r<i;r++){var o=t,a=Math.floor(Math.random()*o.length);e[r]=o[a],t.splice(a,1)}return e},s.prototype.showPlayerDetail=function(t){this.showPlayer(),this.getSong(i.a({},t))},i.c([l("setLocalStorageData")],s.prototype,"setLocalStorageData",void 0),i.c([l("showPlayer")],s.prototype,"showPlayer",void 0),i.c([l("getSong")],s.prototype,"getSong",void 0),s=i.c([a()({components:{Player:v}})],s)}(r.default),m={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"tab-contents"},[e("div",{staticClass:"search-view tab-content",on:{click:function(s){t.onClick(s)}}},[e("div",{staticClass:"search-bar"},[e("div",{staticClass:"input-wrap"},[e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.keyword,expression:"keyword",modifiers:{trim:!0}}],attrs:{type:"text",id:"search",placeholder:"搜索歌曲、歌单、专辑"},domProps:{value:t.keyword},on:{keyup:function(s){t.enter(s)},input:function(s){s.target.composing||(t.keyword=s.target.value.trim())},blur:function(s){t.$forceUpdate()}}}),t._v(" "),e("span",{staticClass:"icon-search"}),t._v(" "),e("span",{directives:[{name:"show",rawName:"v-show",value:t.isShowDelete,expression:"isShowDelete"}],staticClass:"icon-delete"},[t._v("删除")])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowCancel,expression:"isShowCancel"}],staticClass:"search-cancel"},[t._v("取消")])]),t._v(" "),t.history.length>0&&t.isShowHistory?e("div",{staticClass:"record-keys"},[t._l(t.history,function(s){return e("li",[e("a",{staticClass:"record-main",attrs:{href:"#"}},[e("span",{staticClass:"icon icon-clock"}),t._v(" "),e("span",{staticClass:"record-con ellipsis"},[t._v(t._s(s))]),t._v(" "),e("span",{staticClass:"icon icon-close"})])])}),t._v(" "),e("p",{staticClass:"record-delete"},[t._v("清除搜索记录")])],2):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowSearchResults,expression:"isShowSearchResults"}],staticClass:"search-results"},[e("div",{staticClass:"song-list"},t._l(t.searchResult,function(s){return e("div",{key:s.songid,staticClass:"song-item",on:{click:function(e){t.showPlayerDetail(s)}}},[e("i",{staticClass:"icon icon-music"}),t._v(" "),e("div",{staticClass:"song-name",domProps:{innerHTML:t._s(s.songname)}}),t._v(" "),e("div",{staticClass:"song-artist"},t._l(s.singer,function(s){return e("span",{domProps:{innerHTML:t._s(s.name+"&nbsp;")}})}))])})),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.fetching,expression:"fetching"}],staticClass:"search-loading show"},[e("i",{staticClass:"loading-icon"}),t._v(" "),e("div",{staticClass:"loading-text"},[t._v("正在载入更多...")])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLoad,expression:"!isLoad"}],staticClass:"search-loading show"},[e("div",{staticClass:"loading-done"},[t._v("已加载全部")])])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowHistory&&!t.isShowSearchResults,expression:"!isShowHistory && !isShowSearchResults"}],staticClass:"mod-search-result",attrs:{id:"hot-keys"}},[e("h3",{staticClass:"result-tit"},[t._v("热门搜索")]),t._v(" "),e("div",{staticClass:"result-tags"},[t.data.special_url?e("a",{staticClass:"tag tag-hot",attrs:{href:t.data.special_url}},[t._v(t._s(t.data.special_key))]):t._e(),t._v(" "),t._l(t.hotkeys,function(s){return e("a",{key:s.n,staticClass:"tag tag-keyword",attrs:{href:"#"}},[t._v(t._s(s.k))])})],2)])]),t._v(" "),t.isShowPlayer?e("player",{attrs:{song:t.song,artist:t.artist}}):t._e()],1)},staticRenderFns:[]};var w=e("VU/8")(f,m,!1,function(t){e("xGNT")},"data-v-e2f8cfaa",null);s.default=w.exports},xGNT:function(t,s){}});
//# sourceMappingURL=0.da9c76120e167e2e2e0f.js.map